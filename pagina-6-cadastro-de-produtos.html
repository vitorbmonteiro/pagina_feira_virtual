<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Feira Virtual ‚Äî Cadastro de Produtos (Produtor)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Gilda+Display&family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    /* ===== Tokens ===== */
    :root{
      --bg:#F1EEE7; --paper:#FFFFFF; --brand:#8A5A3B; --brand-2:#C1C6AA;
      --text:#2B2B2B; --muted:#6F6F6F; --border:#E8E4DD; --line:#E6E1D6;
      --radius:16px; --shadow:0 6px 20px rgba(0,0,0,.06); --sidebar:#E7D8CB;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:var(--bg); color:var(--text);
      font-family:"Montserrat",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; line-height:1.5;
    }

    /* ===== Tipografia (guia) ===== */
    .h-banner  {font-family:"Gilda Display",serif;font-weight:400;font-size:48px;line-height:1.1}
    .h-section {font-family:"Gilda Display",serif;font-weight:400;font-size:32px;line-height:1.2}
    .h-product {font-family:"Gilda Display",serif;font-weight:400;font-size:40px;line-height:1.2}
    .sub-banner {font:400 16px/1.4 "Montserrat",sans-serif}
    .text-search{font:400 16px/1.6 "Montserrat",sans-serif}
    .producer-name{font:600 18px/1.4 "Montserrat",sans-serif}
    .producer-desc{font:400 14px/1.6 "Montserrat",sans-serif}
    .category-name{font:600 16px/1.4 "Montserrat",sans-serif}
    .price-24{font:700 24px/1.2 "Montserrat",sans-serif}
    .product-desc{font:400 16px/1.6 "Montserrat",sans-serif}
    .cart-label{font:400 16px/1.5 "Montserrat",sans-serif}
    .text-16{font:400 16px/1.6 "Montserrat",sans-serif}
    .text-14{font:400 14px/1.6 "Montserrat",sans-serif}
    .muted{color:var(--muted)}

    /* ===== Header ===== */
    header{background:var(--brand); color:#fff}
    .topbar{max-width:1200px;margin:auto;padding:12px 20px;display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;align-items:center;gap:12px}
    .brand-badge{width:36px;height:36px;border-radius:10px;background:#5E3E29;display:grid;place-items:center;color:#fff;font-weight:700}
    .brand-title{font-family:"Gilda Display",serif;font-size:26px}
    .icons{display:flex;gap:14px}
    .icon{width:34px;height:34px;border-radius:999px;background:rgba(255,255,255,.15);display:grid;place-items:center}

    /* ===== Layout ===== */
    .wrap{max-width:1200px;margin:auto;display:grid;grid-template-columns:240px 1fr;gap:20px;padding:20px}
    @media (max-width:980px){.wrap{grid-template-columns:1fr}}

    /* ===== Sidebar ===== */
    .side{background:var(--sidebar);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:14px;position:sticky;top:16px;height:fit-content}
    .avatar{width:64px;height:64px;border-radius:50%;background:#fff;border:2px solid #c9b6a6;margin:6px auto 12px;display:block}
    .side .group{margin-top:16px}
    .side button{width:100%;background:#fff;border:1px solid var(--border);padding:10px 12px;border-radius:10px;margin-bottom:8px;cursor:pointer;font-weight:600;color:#4b3b30;text-align:left}
    .side button.active{background:#fffaf5;border-color:#d7c3b4}
    .side .danger{background:#f6e9e4;color:#8b2b2b;border-color:#e7c2b8}
    .search{display:flex;gap:8px;align-items:center;background:#fff;border:1px solid var(--border);border-radius:10px;padding:8px 10px;margin-top:10px}
    .search input{border:0;outline:0;width:100%}

    /* ===== Cards/containers ===== */
    .card{background:var(--paper);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
    .main{display:grid;gap:16px}
    .grid{display:grid;gap:14px}
    .grid-2{grid-template-columns:1fr 1fr}
    @media (max-width:980px){.grid-2{grid-template-columns:1fr}}

    /* ===== Form ===== */
    .field{display:grid;gap:6px}
    label{font:600 14px "Montserrat",sans-serif;color:#5b5249}
    input[type="text"],input[type="number"],select,textarea{width:100%;padding:12px 14px;border:1px solid var(--border);border-radius:12px;background:#fff;font:400 15px "Montserrat",sans-serif}
    textarea{min-height:90px;resize:vertical}
    input:focus,select:focus,textarea:focus{outline:3px solid #E3D6CB;border-color:transparent}

    /* ===== Upload ===== */
    .upload{border:2px dashed #cfbda9;border-radius:14px;padding:16px;text-align:center;background:#fffcf8}
    .upload.drag{background:#fffaf2;border-color:#b7947b}
    .upload input{display:none}
    .preview{margin-top:10px;display:grid;grid-template-columns:repeat(auto-fill, minmax(120px,1fr));gap:10px}
    .thumb{position:relative;border:1px solid var(--border);border-radius:12px;overflow:hidden;background:#fff}
    .thumb img{display:block;width:100%;aspect-ratio:4/3;object-fit:cover}
    .thumb button{position:absolute;top:6px;right:6px;border:0;border-radius:999px;background:#0009;color:#fff;width:26px;height:26px;cursor:pointer}

    /* ===== Produtos adicionados ===== */
    .gallery{
      display:grid;
      grid-template-columns:repeat(auto-fit, minmax(220px, 1fr));
      gap:14px;
      align-items:start;
    }
    .p-card{
      min-width:0;
      border:1px solid var(--border); border-radius:14px; overflow:hidden; background:#fff;
      display:flex; flex-direction:column;
    }
    /* √Årea da imagem SEMPRE proporcional, sem vazar */
    .p-card .img{
      position:relative;
      width:100%;
      aspect-ratio:4/3;      /* <‚Äî controla a altura automaticamente */
      overflow:hidden;
      background:#faf7f1;
    }
    .p-card .img img{
      position:absolute; inset:0;
      display:block; width:100%; height:100%;
      object-fit:cover;     /* corta o excesso mantendo propor√ß√£o */
    }
    .p-card .info{padding:10px 12px; display:grid; gap:6px}
    .p-card .row{display:flex; align-items:center; justify-content:space-between; gap:8px; min-width:0}
    .chip{background:#efe7df; border-radius:999px; padding:4px 10px; font-size:12px; white-space:nowrap}

    .btn{border:0; border-radius:999px; padding:10px 14px; cursor:pointer; font-weight:700}
    .btn.primary{background:var(--brand); color:#fff}
    .btn.light{background:#efe7df}
    .btn.ghost{background:transparent; border:1px solid var(--border)}
    .btn.danger{background:#f2d6d1; color:#7a1f1f}

    /* Pain√©is inferiores */
    .badges{display:grid;grid-template-columns:repeat(2,1fr);gap:14px}
    .badge{display:grid;grid-template-columns:140px 1fr;gap:12px;align-items:center;background:#fff;border:1px solid var(--border);border-radius:14px;padding:10px}
    .badge .ph{height:80px;background:#faf7f1;border-radius:12px}
    .badge .perc{font-weight:700;font-size:28px}
    .clients{display:grid;grid-template-columns:repeat(3,1fr);gap:14px}
    .client{background:#fff;border:1px solid var(--border);border-radius:14px;padding:12px;text-align:center}
    .circle{width:68px;height:68px;border-radius:50%;background:#e9e0d8;margin:10px auto}

    /* Footer */
    footer{max-width:1200px;margin:18px auto 24px;padding:0 20px}
    .foot{display:grid;gap:16px;grid-template-columns:repeat(3,1fr)}
    .foot .card{background:#F6F3ED}
    @media (max-width:980px){.foot{grid-template-columns:1fr}}

    /* Ajustes finos de responsividade */
    @media (max-width:600px){
      .p-card .img{ aspect-ratio: 1 / 1; } /* mais quadradinho no mobile */
    }
  </style>
</head>
<body>
  <header>
    <div class="topbar">
      <div class="brand">
        <div class="brand-badge" aria-hidden="true">FV</div>
        <div class="brand-title">Feira Virtual</div>
      </div>
      <div class="icons" aria-label="A√ß√µes">
        <div class="icon">üîî</div><div class="icon">‚ù§Ô∏è</div><div class="icon">üë§</div>
      </div>
    </div>
  </header>

  <div class="wrap">
    <!-- Sidebar -->
    <aside class="side" aria-label="Menu lateral">
      <span class="avatar" aria-hidden="true"></span>
      <div class="producer-name" style="text-align:center">Nome: <span id="produtorNome">Produtor</span></div>
      <div class="text-16" style="text-align:center">Empresa: <span id="produtorEmpresa">Minha Horta</span></div>

      <div class="group">
        <button class="active" type="button">Perfil</button>
        <button type="button" aria-current="page">Produtos</button>
        <button type="button">Clientes</button>
      </div>

      <div class="group">
        <button class="danger" type="button" onclick="alert('Sess√£o finalizada (mock).')">Desconectar</button>
      </div>

      <div class="group">
        <div class="search">
          <span>üîé</span>
          <input id="busca" type="text" class="text-search" placeholder="Digite para filtrar produtos..." />
        </div>
      </div>
    </aside>

    <!-- Main -->
    <main class="main">
      <section class="card">
        <h2 class="h-section">Produtos adicionados</h2>
        <div id="listaProdutos" class="gallery" aria-live="polite"></div>
        <p id="emptyState" class="muted text-14" style="margin-top:8px">Nenhum produto cadastrado ainda.</p>
      </section>

      <section class="card">
        <h2 class="h-section">Novos produtos</h2>
        <form id="formProduto" class="grid grid-2" novalidate>
          <div class="field">
            <label for="nome">Nome do produto</label>
            <input id="nome" type="text" required placeholder="Ex.: Banana prata" />
          </div>
          <div class="field">
            <label for="categoria">Categoria</label>
            <select id="categoria" required>
              <option value="">Selecione‚Ä¶</option>
              <option>Frutas</option><option>Verduras</option><option>Legumes</option>
              <option>Bebidas</option><option>Outros</option>
            </select>
          </div>
          <div class="field">
            <label for="preco">Pre√ßo (R$)</label>
            <input id="preco" type="number" min="0" step="0.01" required placeholder="Ex.: 5,90" />
          </div>
          <div class="field">
            <label for="unidade">Unidade</label>
            <select id="unidade" required>
              <option value="">Selecione‚Ä¶</option>
              <option>Un</option><option>Kg</option><option>Lt</option><option>Bandeja</option>
            </select>
          </div>
          <div class="field">
            <label for="estoque">Estoque</label>
            <input id="estoque" type="number" min="0" step="1" required placeholder="Ex.: 50" />
          </div>
          <div class="field">
            <label for="status">Status</label>
            <select id="status" required>
              <option>Ativo</option><option>Inativo</option>
            </select>
          </div>
          <div class="field" style="grid-column:1/-1">
            <label for="descricao">Descri√ß√£o</label>
            <textarea id="descricao" class="product-desc" placeholder="Detalhe caracter√≠sticas, origem, etc."></textarea>
          </div>

          <div class="field" style="grid-column:1/-1">
            <label>Imagens</label>
            <div id="drop" class="upload" tabindex="0" aria-label="√Årea para arrastar e soltar imagens">
              Arraste e solte imagens aqui ou <label for="file" style="color:#8A5A3B;text-decoration:underline;cursor:pointer">clique para selecionar</label>.
              <input id="file" type="file" accept="image/*" multiple />
              <div id="preview" class="preview" aria-live="polite"></div>
            </div>
          </div>

          <div style="grid-column:1/-1;display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn primary cart-label" type="submit">Adicionar produto</button>
            <button class="btn ghost cart-label" type="reset">Limpar</button>
          </div>
        </form>
      </section>

      <section class="grid grid-2">
        <div class="card">
          <h2 class="h-section">Mais vendidos</h2>
          <div class="badges">
            <div class="badge"><div class="ph"></div><div><div class="category-name">Produto A</div><div class="perc">20% <span class="muted">das vendas</span></div></div></div>
            <div class="badge"><div class="ph"></div><div><div class="category-name">Produto B</div><div class="perc">25% <span class="muted">das vendas</span></div></div></div>
          </div>
        </div>
        <div class="card">
          <h2 class="h-section">Clientes</h2>
          <div class="clients">
            <div class="client"><div class="circle"></div><div class="producer-name" style="font-size:16px">Cliente</div></div>
            <div class="client"><div class="circle"></div><div class="producer-name" style="font-size:16px">Cliente</div></div>
            <div class="client"><div class="circle"></div><div class="producer-name" style="font-size:16px">Cliente</div></div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <footer>
    <div class="foot">
      <div class="card"><h3 class="h-section" style="font-size:24px">Feira Virtual</h3><p class="muted">Conectando voc√™ a pequenos produtores: do campo √† sua mesa.</p></div>
      <div class="card"><h3 class="h-section" style="font-size:24px">Navega√ß√£o</h3><p class="text-16">P√°gina Inicial ‚Ä¢ Produtores ‚Ä¢ Categorias ‚Ä¢ Novidades</p></div>
      <div class="card"><h3 class="h-section" style="font-size:24px">Informa√ß√µes</h3><p class="text-14">Fale Conosco ‚Ä¢ Termos de Uso ‚Ä¢ Pol√≠tica de Privacidade</p></div>
    </div>
  </footer>

  <script>
    // ===== Helpers =====
    const $ = (s, r=document)=>r.querySelector(s);
    const money = v => Number(v).toLocaleString('pt-BR',{style:'currency',currency:'BRL'});

    // ===== Storage com reset via ?reset=1 =====
    const STORAGE_KEY = 'produtosFV';
    if (new URLSearchParams(location.search).get('reset') === '1') {
      localStorage.removeItem(STORAGE_KEY);
      history.replaceState(null, '', location.pathname); // limpa o ?reset=1 da URL
    }

    // Estado
    const state = {
      produtos: JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'),
      imagensBuffer: []
    };

    // Seed confi√°vel (usa imagens na RAIZ do repo)
    (function seedIfNeeded(){
      const hasImg = state.produtos.some(p => Array.isArray(p.imagens) && p.imagens.length > 0);
      if (!state.produtos.length || !hasImg) {
        state.produtos = [
          { nome:'Banana Prata',     categoria:'Frutas',  preco:5.90,  unidade:'Kg', estoque:30, status:'Ativo', descricao:'Banana fresca.',    imagens:['banana_prata.jpg'] },
          { nome:'Geleia de Goiaba', categoria:'Outros',  preco:12.00, unidade:'Un', estoque:12, status:'Ativo', descricao:'Geleia artesanal.', imagens:['geleia_goiaba.webp'] },
          { nome:'Leite de Coco',    categoria:'Bebidas', preco:8.50,  unidade:'Lt', estoque:20, status:'Ativo', descricao:'Extrato natural.',  imagens:['leite_coco.jpg'] },
          { nome:'Uva It√°lia',       categoria:'Frutas',  preco:11.90, unidade:'Kg', estoque:18, status:'Ativo', descricao:'Doce e fresca.',    imagens:['uva.jpg'] }
        ];
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state.produtos));
      }
    })();

    // ===== Render =====
    const lista = $('#listaProdutos');
    const emptyState = $('#emptyState');

    function imgTag(src, alt){
      // fallback visual se a imagem faltar (n√£o estoura o layout)
      return `<img src="${src}" alt="${alt}" loading="lazy" onerror="this.replaceWith(document.createTextNode('üñºÔ∏è'))">`;
    }

    function renderLista(filter=''){
      lista.innerHTML = '';
      const dados = state.produtos.filter(p => p.nome.toLowerCase().includes(filter.toLowerCase()));
      emptyState.style.display = dados.length ? 'none' : 'block';

      dados.forEach((p, idx)=>{
        const card = document.createElement('div');
        card.className = 'p-card';
        card.innerHTML = `
          <div class="img">${p.imagens?.length ? imgTag(p.imagens[0], p.nome) : 'üñºÔ∏è'}</div>
          <div class="info">
            <div class="row">
              <div class="category-name" style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${p.nome}</div>
              <div class="chip">${p.unidade}</div>
            </div>
            <div class="row">
              <div>
                <span class="price-24">${money(p.preco)}</span>
                <span class="text-14 muted"> ‚Ä¢ Estoque: ${p.estoque}</span>
              </div>
              <span class="text-14 muted" style="overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${p.categoria}</span>
            </div>
            ${p.descricao ? `<p class="product-desc" style="margin:4px 0 0">${p.descricao}</p>` : ''}
            <div class="row" style="margin-top:8px">
              <button class="btn light cart-label" data-editar="${idx}">Editar</button>
              <div>
                <button class="btn ghost cart-label" data-detalhes="${idx}">Detalhes</button>
                <button class="btn danger cart-label" data-excluir="${idx}">Excluir</button>
              </div>
            </div>
          </div>`;
        lista.appendChild(card);
      });
    }

    // Filtro
    $('#busca').addEventListener('input', e=> renderLista(e.target.value));

    // Upload (drag & drop) ‚Äî pr√©vias
    const drop = $('#drop'), fileInput = $('#file'), preview = $('#preview');
    function addFiles(files){
      for(const f of files){
        if(!f.type.startsWith('image/')) continue;
        const url = URL.createObjectURL(f);
        state.imagensBuffer.push({file:f, url});
        const box = document.createElement('div');
        box.className = 'thumb';
        box.innerHTML = `<img src="${url}" alt="Pr√©via"><button type="button">‚úï</button>`;
        box.querySelector('button').onclick = ()=>{
          URL.revokeObjectURL(url);
          state.imagensBuffer = state.imagensBuffer.filter(i=>i.url!==url);
          box.remove();
        };
        preview.appendChild(box);
      }
    }
    drop?.addEventListener('dragover', e=>{e.preventDefault(); drop.classList.add('drag')});
    drop?.addEventListener('dragleave', ()=> drop.classList.remove('drag'));
    drop?.addEventListener('drop', e=>{e.preventDefault(); drop.classList.remove('drag'); addFiles(e.dataTransfer.files)});
    fileInput?.addEventListener('change', e=> addFiles(e.target.files));

    // Form
    const form = $('#formProduto');
    form.addEventListener('submit', e=>{
      e.preventDefault();
      const nome = $('#nome').value.trim();
      const categoria = $('#categoria').value;
      const preco = parseFloat($('#preco').value.replace(',','.'));
      const unidade = $('#unidade').value;
      const estoque = parseInt($('#estoque').value);
      const status = $('#status').value;
      const descricao = $('#descricao').value.trim();
      if(!nome || !categoria || !unidade || isNaN(preco) || isNaN(estoque)){
        alert('Preencha os campos obrigat√≥rios.'); return;
      }
      const imagens = state.imagensBuffer.map(i=>i.url); // pr√©vias locais
      state.produtos.push({nome,categoria,preco,unidade,estoque,status,descricao,imagens,createdAt:Date.now()});
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state.produtos));
      form.reset(); preview.innerHTML=''; state.imagensBuffer=[];
      renderLista($('#busca').value); window.scrollTo({top:0,behavior:'smooth'});
    });

    // A√ß√µes dos cards
    const listaEl = document.getElementById('listaProdutos');
    listaEl.addEventListener('click', e=>{
      const del = e.target.closest('[data-excluir]');
      const det = e.target.closest('[data-detalhes]');
      const edt = e.target.closest('[data-editar]');
      if(del){
        const i = +del.dataset.excluir;
        if(confirm('Excluir este produto?')){
          state.produtos.splice(i,1);
          localStorage.setItem(STORAGE_KEY, JSON.stringify(state.produtos));
          renderLista($('#busca').value);
        }
      }
      if(det){
        const p = state.produtos[+det.dataset.detalhes];
        alert(`${p.nome}\n${p.categoria} ‚Ä¢ ${money(p.preco)} ‚Ä¢ ${p.unidade}\nEstoque: ${p.estoque}\nStatus: ${p.status}\n\n${p.descricao||''}`);
      }
      if(edt){
        const i = +edt.dataset.editar;
        const p = state.produtos[i];
        $('#nome').value=p.nome; $('#categoria').value=p.categoria; $('#preco').value=p.preco;
        $('#unidade').value=p.unidade; $('#estoque').value=p.estoque; $('#status').value=p.status; $('#descricao').value=p.descricao||'';
        preview.innerHTML=''; state.imagensBuffer=[];
        state.produtos.splice(i,1);
        localStorage.setItem(STORAGE_KEY, JSON.stringify(state.produtos));
        renderLista($('#busca').value);
        window.scrollTo({top:document.body.scrollHeight,behavior:'smooth'});
      }
    });

    // Start
    renderLista();
  </script>
</body>
</html>




